{"version":3,"sources":["../src/advanced-dialog.js"],"names":[],"mappings":"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","file":"advanced-dialog.js","sourcesContent":["// CodeMirror, copyright (c) by Marijn Haverbeke and others\n// Distributed under an MIT license: http://codemirror.net/LICENSE\n// Advanced dialog plugin written by Jamie Morris\n// Open advanced dialogs on top of an editor. Relies on dialog.css.\n\n(function (mod) {\n    if (typeof exports == \"object\" && typeof module == \"object\") // CommonJS\n        mod(require(\"codemirror\"));\n    else if (typeof define == \"function\" && define.amd) // AMD\n        define([\"codemirror\"], mod);\n    else // Plain browser env\n        mod(CodeMirror);\n})((CodeMirror) => {\n    let createPanel = (cm, template, bottom, height) => {\n        let el = document.createElement(\"div\");\n        el.className = 'CodeMirror-advanced-dialog';\n\n        if (typeof template == \"string\") {\n            el.innerHTML = template;\n        } else { // Assuming it's a detached DOM element.\n            el.appendChild(template);\n        }\n        let panel = cm.addPanel(el, {\n            position: bottom ? \"bottom\" : \"top\",\n            height\n        });\n        return panel;\n    }\n\n    let closePanel = (cm) => {\n        let state = cm.state.advancedDialog;\n        if (!state || !state.current) {\n            return;\n        }\n\n        state.current.panel.clear();\n\n        if (state.current.onClose) state.current.onClose(state.current.panel.node);\n        delete state.current;\n        cm.focus();\n    }\n\n    CodeMirror.defineExtension(\"openAdvancedDialog\", function (template, options) {\n        if (!this.addPanel) {\n            throw `CodeMirror-AdvancedDialog requires the panel addon to be included in the page.  This can usually be found in the addons folder of the default CodeMirror installation, and must be included BEFORE the AdvancedDialog addon.`;\n        }\n        if (!options) options = {};\n        if (!this.state.advancedDialog) this.state.advancedDialog = {};\n\n        if (this.state.advancedDialog.current) {\n            closePanel(this);\n        }\n\n        let panel = createPanel(this, template, options.bottom, options.shrinkEditor ? null : \"0\");\n        this.state.advancedDialog.current = {\n            panel: panel,\n            onClose: options.onClose\n        };\n\n        let inputs = panel.node.getElementsByTagName(\"input\");\n        let buttons = panel.node.getElementsByTagName(\"button\");\n        if (inputs && inputs.length > 0 && options.inputBehaviours) {\n            for (let i = 0; i < options.inputBehaviours.length; i++) {\n                let behaviour = options.inputBehaviours[i];\n                let input = inputs[i];\n                if (behaviour.value) {\n                    input.value = behaviour.value;\n                }\n\n                if (!!behaviour.focus) {\n                    input.focus();\n                }\n\n                if (!!behaviour.selectValueOnOpen) {\n                    input.select();\n                }\n\n                if (behaviour.onInput) {\n                    CodeMirror.on(input, \"input\", (e) => {\n                        behaviour.onInput(inputs, e);\n                    });\n                }\n\n                if (behaviour.onKeyUp) {\n                    CodeMirror.on(input, \"keyup\", (e) => {\n                        behaviour.onKeyUp(inputs, e);\n                    });\n                }\n\n                CodeMirror.on(input, \"keydown\", (e) => {\n                    if (behaviour.onKeyDown && behaviour.onKeyDown(inputs, e)) {\n                        return;\n                    }\n\n                    if (e.keyCode === 27 || (!!behaviour.closeOnEnter && e.keyCode === 13)) {\n                        input.blur();\n                        CodeMirror.e_stop(e);\n                        closePanel(this);\n                    } else if (e.keyCode === 13 && behaviour.callback) {\n                        behaviour.callback(inputs, e);\n                    }\n                });\n\n                if (behaviour.closeOnBlur !== false) CodeMirror.on(input, \"blur\", () => {\n                    closePanel(this);\n                });\n            }\n        }\n\n        if (buttons && buttons.length > 0 && options.buttonBehaviours) {\n            for (let i = 0; i < options.buttonBehaviours.length; i++) {\n                let behaviour = options.buttonBehaviours[i];\n                if (!!behaviour.callback) {\n                    CodeMirror.on(buttons[i], \"click\", (e) => {\n                        behaviour.callback(inputs, e);\n                    });\n                } else {\n                    CodeMirror.on(buttons[i], \"click\", () => {\n                        closePanel(this);\n                    });\n                }\n            }\n        }\n        return () => {\n            closePanel(this);\n        };\n    });\n});"]}